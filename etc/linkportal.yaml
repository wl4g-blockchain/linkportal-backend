# SPDX-License-Identifier: GNU GENERAL PUBLIC LICENSE Version 3
#
# Copyleft (c) 2024 James Wong. This file is part of James Wong.
# is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the
# Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# James Wong is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with James Wong.  If not, see <https://www.gnu.org/licenses/>.
#
# IMPORTANT: Any software that fully or partially contains or uses materials
# covered by this license must also be released under the GNU GPL license.
# This includes modifications and derived works.
#

service-name: linkportal

server:
  host: 0.0.0.0
  port: 9000
  context-path: "/"

mgmt:
  enabled: true
  host: 0.0.0.0
  port: 9001
  tokio-console:
    enabled: true
    server-bind: "0.0.0.0:6669"
    retention: 60
  pyroscope:
    # Because of known-issues: https://github.com/grafana/pyroscope-rs/issues/174
    # https://github.com/tikv/pprof-rs/issues/232 Therefore it is not enabled by default for now.
    enabled: false
    server-url: "http://localhost:4040"
    tags: []
    sample-rate: 0.1
  # Notice: More OTEL custom configuration use to env: OTEL_SPAN_xxx, see: opentelemetry_sdk::trace::config::default()
  otel:
    enabled: true
    endpoint: "http://localhost:4317"
    protocol: grpc # Optional: http/protobuf,http/json,grpc
    timeout: 10000

logging:
  mode: HUMAN # Options: HUMAN|JSON
  level: DEBUG

swagger:
  enabled: true
  # title: "LinkPortal API Server"
  # description: "The LinkPortal backend API Server"
  # version: "1.0.0"
  # license_name: "Apache 2.0"
  # license_url: "https://www.apache.org/licenses/LICENSE-2.0"
  # contact_name: "LinkPortal API"
  # contact_email: "jameswong1376@gmail.com"
  # contact_url: "https://github.com/wl4g-blockchain/linkportal-backend"
  # terms_of_service: "api/terms-of-service"
  ui_path: "/swagger-ui"
  openapi_url: "/swagger-ui/openapi.json"

auth:
  jwt-ak-name: "_ak"
  jwt-rk-name: "_rk"
  jwt-validity-ak: 3600000
  jwt-validity-rk: 86400000
  jwt-algorithm: "HS256"
  #jwt-secret: "<YOUR_JWT_SECRET>" # Generated by default. Refer to: .env
  anonymous-paths:
    - "/_/healthz"
    - "/_/healthz/**"
    # The default accessing to swagger ui required authentication.
    - "/swagger-ui/"
    - "/swagger-ui/openapi.json"
    - "/public/**"
    - "/static/**"
  oidc:
    enabled: true
    client-id: "<YOUR_OIDC_CLIENT_ID>" # Refer to: .env
    #client-secret: "<YOUR_OIDC_CLIENT_SECRET>" # Refer to: .env
    issue-url: "https://iam.wl4g.com/realms/master"
    #redirect-url: "http://localhost:8888/serve/auth/callback/oidc"
    redirect-url: "http://wl4g.local:10000/serve/auth/callback/oidc"
    scope: "openid profile email"
  # see:https://github.com/settings/developers
  # see:https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps
  github:
    enabled: true
    #client-id: "<YOUR_GITHUB_CLIENT_ID>" # Refer to: .env
    #client-secret: "<YOUR_GITHUB_CLIENT_SECRET>" # Refer to: .env
    auth-url: "https://github.com/login/oauth/authorize"
    token-url: "https://github.com/login/oauth/access_token"
    #redirect-url: "http://localhost:8888/serve/auth/callback/github"
    redirect-url: "http://wl4g.local:10000/serve/auth/callback/github"
    # see:https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/scopes-for-oauth-apps
    scope: "user"
    user-info-url: "https://api.github.com/user"
  login-url: "/static/login.html"
  success-url: "/static/index.html"
  unauthz-url: "/static/403.html"

cache:
  provider: Memory # Memory|Redis
  memory:
    initial-capacity: 32
    max-capacity: 65535
    ttl: 3600000
    eviction-policy: LRU
  redis:
    nodes: ["redis://127.0.0.1:6379"]
    username: "default" # eg: "default"
    password: "bitnami" # eg: "bitnami", refer to: .env
    connection-timeout: 3000
    response-timeout: 6000
    retries: 1
    max-retry-wait: 65536
    min-retry-wait: 1280
    read-from-replica: true

appdb:
  type: "POSTGRESQL" # Options: SQLITE|POSTGRESQL|MONGODB
  sqlite:
    dir: "/tmp/linkportal/appdb/sqlite"
  postgres: # App DB for PostgreSQL
    host: "127.0.0.1"
    port: 35432
    database: "linkportal"
    schema: "public"
    username: postgres
    password: "123456"
    min-connections: 1
    max-connections: 10
    use-ssl: false
  mongodb:
    url: mongodb://127.0.0.1:27017/linkportal
    database: linkportal

vecdb:
  type: "PGVECTOR" # Options: PGVECTOR
  pg-vector: # Vector DB for PostgreSQL
    host: "127.0.0.1"
    port: 5432
    database: "postgres"
    schema: "public"
    username: "postgres"
    password: "changeit"
    min-connections: 1
    max-connections: 10
    use-ssl: false

services:
  # Chain transaction event data Analysis updater.
  updaters:
    - kind: "ETHEREUM"
      name: "mainnetEthTxLogUpdater"
      enabled: true
      cron: "0 * * * * *"
      channel-size: 100
      chain:
        chain-id: "1"
        http-rpc-url: "https://eth-mainnet.g.alchemy.com/v2/M8QUxbFISVXMqMxvWWKx-N2cxUJF9jmD"
        ws-rpc-url: "wss://eth-mainnet.g.alchemy.com/v2/M8QUxbFISVXMqMxvWWKx-N2cxUJF9jmD"
        # e.g: export LINKPORTAL__SERVICES__UPDATERS[0]__CHAIN__ABI_PATH="${workspaceFolder}/etc/abi/UniswapV2Factory.json"
        abi-path: "/etc/linkportal/abi/UniswapV2Factory.json"
        contract-addrs:
          - "0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419" # e.g: Uniswap V2 factory contract.
        filters:
          - PairCreated
    # - kind: "ETHEREUM"
    #   name: "sepoliaEthTxLogUpdater"
    #   enabled: true
    #   cron: "0 * * * * *"
    #   channel-size: 100
    #   chain:
    #     chain-id: "11155111" # see:https://chainlist.org/chain/11155111?testnets=true
    #     http-rpc-url: "https://eth-sepolia.g.alchemy.com/v2/<YOUR_API_KEY>"
    #     ws-rpc-url: "wss://eth-sepolia.g.alchemy.com/v2/<YOUR_API_KEY>"
    #     abi-path: "/etc/linkportal/abi/UniswapV2Factory.json"
    #     contract-addrs:
    #       - "0x..."
    #     filters: []
    # - kind: "SOLANA"
    #   name: "mainnetSolTxLogUpdater"
    #   enabled: true
    #   cron: "0 * * * * *"
    #   channel-size: 100
    #   chain:
    #     chain-id: "mainnet"
    #     http-rpc-url: "https://solana-mainnet.g.alchemy.com/v2/<YOUR_API_KEY>"
    #     ws-rpc-url: "wss://solana-mainnet.g.alchemy.com/v2/<YOUR_API_KEY>"
    #     abi-path: "/etc/linkportal/abi/<YOUR_SOLANA_CONTRACT_ABI>.json"
    #     contract-addrs:
    #       - "0x..."
    #     filters: []

  # see:https://platform.openai.com/docs/guides/completions
  # see:https://github.com/ollama/ollama/blob/main/docs/api.md#generate-a-completion
  # see:https://help.aliyun.com/zh/model-studio/getting-started/what-is-model-studio#16693d2e3fmir
  llm:
    embedding:
      api-uri: "http://localhost:11434/api/embed"
      #api-key: "<YOUR EMBEDDING API KEY>" # refer to:./.env
      model: "bge-m3:latest"
      org-id: # Optional
      project-id: # Optional
      pre-delete-collection: false
      vector-dimensions: 1536
    generate:
      # Notice: The '__' should be used to distinguish different levels of structure properties, such as:
      # LINKPORTAL__LLM__API_KEY to match LinkPortalProperties{llm:LlmProperties{completion:GenerateProperties{api_key}}}
      api-uri: "https://dashscope.aliyuncs.com/compatible-mode/v1"
      #api-key: "<YOUR GENERATE API KEY>" # refer to:./.env
      org-id: # Optional
      project-id: # Optional
      model: "qwen-plus"
      max-tokens: 65535
      temperature: 0.1
      candidate-count: 3
      top-k: 1
      top-p: 0.9
      system-prompt: |-
        You are a block chain security expert.

